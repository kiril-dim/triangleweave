  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Weave</title>
    <style>
        h1 {
            text-align: center;
            color: #333;
            margin: 20px 0;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 1px solid #ccc;
            display: block;
            margin: 10px auto;
        }
        body {
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        .controls {
            width: 80%;
            max-width: 600px;
            margin: 20px auto;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .slider-container {
            margin: 10px 0;
        }
        .slider-container label {
            display: inline-block;
            width: 150px;
            margin-right: 10px;
        }
        .slider-container input {
            width: 200px;
        }
        .slider-container span {
            margin-left: 10px;
            min-width: 40px;
            display: inline-block;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        button {
            display: inline-block;
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>Line Weave</h1>
    <div class="controls" style="margin-bottom: 20px;">
        <div class="slider-container">
            <label for="maxLines">Max Lines:</label>
            <input type="range" id="maxLines" min="10" max="200" value="50">
            <span id="maxLinesValue">50</span>
        </div>
        <div class="slider-container">
            <label for="growthSpeed">Growth Speed:</label>
            <input type="range" id="growthSpeed" min="0.5" max="10" value="2" step="0.5">
            <span id="growthSpeedValue">2</span>
        </div>
        <div class="button-container">
            <button id="restart">Restart</button>
        </div>
    </div>
    
    <canvas id="lineCanvas" width="800" height="600"></canvas>

    <script>
        class Line {
            constructor(x, y, angle) {
                this.startX = x;
                this.startY = y;
                this.angle = angle;
                this.length1 = 0;  // Length in negative direction
                this.length2 = 0;  // Length in positive direction
                this.growing1 = true;  // Growing in negative direction
                this.growing2 = true;  // Growing in positive direction
            }

            grow(speed) {
                if (this.growing1) this.length1 += speed;
                if (this.growing2) this.length2 += speed;
            }

            getEndPoints() {
                const dx1 = Math.cos(this.angle) * this.length1;
                const dy1 = Math.sin(this.angle) * this.length1;
                const dx2 = Math.cos(this.angle) * this.length2;
                const dy2 = Math.sin(this.angle) * this.length2;
                
                return {
                    x1: this.startX - dx1,
                    y1: this.startY - dy1,
                    x2: this.startX + dx2,
                    y2: this.startY + dy2
                };
            }

            draw(ctx) {
                const points = this.getEndPoints();
                ctx.beginPath();
                ctx.moveTo(points.x1, points.y1);
                ctx.lineTo(points.x2, points.y2);
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        const canvas = document.getElementById('lineCanvas');
        const ctx = canvas.getContext('2d');
        let lines = [];
        
        // Get controls
        const maxLinesInput = document.getElementById('maxLines');
        const growthSpeedInput = document.getElementById('growthSpeed');
        const restartButton = document.getElementById('restart');
        const maxLinesValue = document.getElementById('maxLinesValue');
        const growthSpeedValue = document.getElementById('growthSpeedValue');

        // Update display values
        maxLinesInput.addEventListener('input', () => {
            maxLinesValue.textContent = maxLinesInput.value;
        });
        
        growthSpeedInput.addEventListener('input', () => {
            growthSpeedValue.textContent = growthSpeedInput.value;
        });

        function findIntersection(x1, y1, x2, y2, x3, y3, x4, y4) {
            const denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);
            if (denominator === 0) return null;

            const t = ((x1 - x3) * (y3 - y4) - (y1 - y3) * (x3 - x4)) / denominator;
            const u = -((x1 - x2) * (y1 - y3) - (y1 - y2) * (x1 - x3)) / denominator;

            if (t >= 0 && t <= 1 && u >= 0 && u <= 1) {
                return {
                    x: x1 + t * (x2 - x1),
                    y: y1 + t * (y2 - y1),
                    t: t
                };
            }
            return null;
        }

        function checkLineIntersections(currentLine) {
            const points = currentLine.getEndPoints();
            let minT1 = Infinity;
            let minT2 = Infinity;
            
            // Check against all other lines
            for (let i = 0; i < lines.length - 1; i++) {
                const otherPoints = lines[i].getEndPoints();
                
                if (currentLine.growing1) {
                    const intersection = findIntersection(
                        currentLine.startX, currentLine.startY,
                        points.x1, points.y1,
                        otherPoints.x1, otherPoints.y1,
                        otherPoints.x2, otherPoints.y2
                    );
                    if (intersection && intersection.t < minT1) {
                        minT1 = intersection.t;
                        currentLine.length1 = intersection.t * 
                            Math.sqrt(Math.pow(points.x1 - currentLine.startX, 2) + 
                                    Math.pow(points.y1 - currentLine.startY, 2));
                        currentLine.growing1 = false;
                    }
                }

                if (currentLine.growing2) {
                    const intersection = findIntersection(
                        currentLine.startX, currentLine.startY,
                        points.x2, points.y2,
                        otherPoints.x1, otherPoints.y1,
                        otherPoints.x2, otherPoints.y2
                    );
                    if (intersection && intersection.t < minT2) {
                        minT2 = intersection.t;
                        currentLine.length2 = intersection.t * 
                            Math.sqrt(Math.pow(points.x2 - currentLine.startX, 2) + 
                                    Math.pow(points.y2 - currentLine.startY, 2));
                        currentLine.growing2 = false;
                    }
                }
            }
        }

        function checkBoundaryIntersections(currentLine) {
            const points = currentLine.getEndPoints();
            
            // Check end 1
            if (currentLine.growing1 && (
                points.x1 < 0 || points.x1 > canvas.width ||
                points.y1 < 0 || points.y1 > canvas.height
            )) {
                currentLine.growing1 = false;
            }
            
            // Check end 2
            if (currentLine.growing2 && (
                points.x2 < 0 || points.x2 > canvas.width ||
                points.y2 < 0 || points.y2 > canvas.height
            )) {
                currentLine.growing2 = false;
            }
        }

        function createNewLine() {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            const angle = Math.random() * Math.PI * 2;
            return new Line(x, y, angle);
        }

        function animate() {
            // If there's no growing line, create a new one
            if (!lines.length || (!lines[lines.length - 1].growing1 && !lines[lines.length - 1].growing2)) {
                lines.push(createNewLine());
            }

            const currentLine = lines[lines.length - 1];
            
            if (currentLine.growing1 || currentLine.growing2) {
                checkLineIntersections(currentLine);
                checkBoundaryIntersections(currentLine);
                
                if (currentLine.growing1 || currentLine.growing2) {
                    currentLine.grow(parseFloat(growthSpeedInput.value));
                }
            }

            // Clear and redraw everything
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            lines.forEach(line => line.draw(ctx));

            // Continue animation if we haven't reached max lines
            if (lines.length < parseInt(maxLinesInput.value)) {
                requestAnimationFrame(animate);
            }
        }

        // Start animation
        function start() {
            lines = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            animate();
        }

        // Add restart button handler
        restartButton.addEventListener('click', start);

        // Initial start
        start();
    </script>
</body>
</html>
